<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarioPro - Test Caricamento File</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            text-align: center;
            color: white;
            max-width: 500px;
            padding: 20px;
        }
        
        .upload-box {
            background: rgba(255, 255, 255, 0.1);
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 40px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-box:hover {
            border-color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .upload-box h2 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .upload-box p {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .formats {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .format {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        #fileInput {
            display: none;
        }
        
        .debug {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log.info { background: rgba(33, 150, 243, 0.3); }
        .log.success { background: rgba(76, 175, 80, 0.3); }
        .log.error { background: rgba(244, 67, 54, 0.3); }
        
        .status {
            font-size: 18px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßä MarioPro - Test Debug</h1>
        
        <div class="status" id="status">Inizializzazione...</div>
        
        <div class="upload-box" onclick="openFileDialog()">
            <h2>üìÅ TEST Carica File</h2>
            <p>Clicca qui per testare il caricamento</p>
            <div class="formats">
                <span class="format">GLTF</span>
                <span class="format">GLB</span>
                <span class="format">DAE</span>
            </div>
        </div>
        
        <input type="file" id="fileInput" accept=".gltf,.glb,.dae">
        
        <div class="debug" id="debug">
            <div class="log info">üöÄ Inizio debug...</div>
        </div>
    </div>

    <script>
        // Sistema di log
        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            const debugDiv = document.getElementById('debug');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            debugDiv.appendChild(logDiv);
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            log(message, 'info');
        }
        
        // Test 1: Verifiche iniziali
        document.addEventListener('DOMContentLoaded', function() {
            log('üìã DOM caricato', 'success');
            
            // Test elementi
            const fileInput = document.getElementById('fileInput');
            const uploadBox = document.querySelector('.upload-box');
            
            log(`üîç File input trovato: ${!!fileInput}`, fileInput ? 'success' : 'error');
            log(`üîç Upload box trovata: ${!!uploadBox}`, uploadBox ? 'success' : 'error');
            
            if (!fileInput) {
                updateStatus('‚ùå ERRORE: File input non trovato!');
                return;
            }
            
            // Test 2: Event listener file input
            try {
                fileInput.addEventListener('change', function(e) {
                    log('üìÅ Event change triggerato!', 'success');
                    log(`üìÅ Files selezionati: ${e.target.files.length}`, 'info');
                    
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        log(`üìÅ File: ${file.name} (${file.size} bytes)`, 'success');
                        updateStatus(`‚úÖ File selezionato: ${file.name}`);
                        testFile(file);
                    } else {
                        log('üìÅ Nessun file selezionato', 'error');
                        updateStatus('‚ùå Nessun file selezionato');
                    }
                });
                log('üéØ Event listener configurato', 'success');
            } catch (error) {
                log(`‚ùå Errore setup event listener: ${error.message}`, 'error');
                updateStatus('‚ùå Errore setup event listener');
            }
            
            updateStatus('‚úÖ Pronto per il test');
        });
        
        // Test 3: Funzione click
        function openFileDialog() {
            log('üëÜ Click su upload box', 'info');
            
            const fileInput = document.getElementById('fileInput');
            if (!fileInput) {
                log('‚ùå File input non trovato nel click!', 'error');
                updateStatus('‚ùå File input non trovato');
                return;
            }
            
            try {
                log('üñ±Ô∏è Tentativo click programmatico...', 'info');
                fileInput.click();
                log('‚úÖ Click eseguito', 'success');
            } catch (error) {
                log(`‚ùå Errore nel click: ${error.message}`, 'error');
                updateStatus('‚ùå Errore nel click');
            }
        }
        
        // Test 4: Analisi file
        function testFile(file) {
            log('üî¨ Inizio analisi file...', 'info');
            
            const name = file.name.toLowerCase();
            const ext = name.split('.').pop();
            const size = (file.size / 1024 / 1024).toFixed(2);
            
            log(`üìä Nome: ${file.name}`, 'info');
            log(`üìä Estensione: ${ext}`, 'info');
            log(`üìä Dimensione: ${size} MB`, 'info');
            log(`üìä Tipo MIME: ${file.type}`, 'info');
            
            // Test formato
            if (['gltf', 'glb', 'dae'].includes(ext)) {
                log(`‚úÖ Formato supportato: ${ext}`, 'success');
                updateStatus(`‚úÖ File ${ext.toUpperCase()} valido!`);
                
                // Test lettura
                testFileReading(file, ext);
            } else {
                log(`‚ùå Formato non supportato: ${ext}`, 'error');
                updateStatus(`‚ùå Formato ${ext} non supportato`);
            }
        }
        
        // Test 5: Lettura file
        function testFileReading(file, ext) {
            log('üìñ Test lettura file...', 'info');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const dataSize = e.target.result ? 
                    (typeof e.target.result === 'string' ? e.target.result.length : e.target.result.byteLength) : 0;
                
                log(`‚úÖ File letto! Dati: ${dataSize} caratteri/bytes`, 'success');
                updateStatus(`‚úÖ File letto correttamente (${dataSize} bytes)`);
                
                // Test Three.js (se disponibile)
                testThreeJS();
            };
            
            reader.onerror = function(e) {
                log(`‚ùå Errore lettura file: ${e.target.error}`, 'error');
                updateStatus('‚ùå Errore nella lettura del file');
            };
            
            reader.onprogress = function(e) {
                if (e.lengthComputable) {
                    const percent = (e.loaded / e.total * 100).toFixed(1);
                    log(`üìñ Lettura: ${percent}%`, 'info');
                }
            };
            
            try {
                if (ext === 'glb') {
                    reader.readAsArrayBuffer(file);
                } else {
                    reader.readAsText(file);
                }
            } catch (error) {
                log(`‚ùå Errore avvio lettura: ${error.message}`, 'error');
                updateStatus('‚ùå Errore avvio lettura file');
            }
        }
        
        // Test 6: Three.js
        function testThreeJS() {
            log('üéÆ Test Three.js...', 'info');
            
            // Test caricamento script
            const scripts = document.querySelectorAll('script[src*="three"]');
            log(`üîç Script Three.js trovati: ${scripts.length}`, scripts.length > 0 ? 'success' : 'error');
            
            // Test oggetto THREE
            if (typeof THREE !== 'undefined') {
                log('‚úÖ THREE disponibile', 'success');
                log(`üì¶ Versione THREE: ${THREE.REVISION || 'unknown'}`, 'info');
                
                // Test loader
                if (THREE.GLTFLoader) {
                    log('‚úÖ GLTFLoader disponibile', 'success');
                } else {
                    log('‚ùå GLTFLoader NON disponibile', 'error');
                }
                
                if (THREE.ColladaLoader) {
                    log('‚úÖ ColladaLoader disponibile', 'success');
                } else {
                    log('‚ùå ColladaLoader NON disponibile', 'error');
                }
                
                updateStatus('‚úÖ Tutti i test completati - FUNZIONANTE!');
            } else {
                log('‚ùå THREE NON disponibile', 'error');
                updateStatus('‚ùå Three.js non caricato');
            }
        }
        
        // Test iniziale
        log('üéØ Sistema di debug caricato', 'success');
        
        // Test periodico
        setTimeout(() => {
            log('‚è∞ Test automatico...', 'info');
            const fileInput = document.getElementById('fileInput');
            log(`üîÑ File input ancora presente: ${!!fileInput}`, fileInput ? 'success' : 'error');
        }, 2000);
    </script>
</body>
</html>
