<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Universal 3D Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/loaders/ColladaLoader.js"></script>
  <style>
    body { margin:0; font-family:sans-serif; background:#111; color:#eee; }
    #topbar { padding:10px; background:#222; }
    #viewer { width:100%; height:calc(100vh - 50px); }
  </style>
</head>
<body>
  <div id="topbar">
    <input type="file" id="fileInput" accept=".dae,.glb,.gltf,.obj" />
    <span>Carica un modello (.dae, .glb, .gltf, .obj)</span>
  </div>
  <div id="viewer"></div>

<script>
let scene, camera, renderer, controls, currentObject;

// Setup scena
scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,2,5);

renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight-50);
document.getElementById("viewer").appendChild(renderer.domElement);

controls = new THREE.OrbitControls(camera, renderer.domElement);

const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
scene.add(hemiLight);
const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(5,10,7);
scene.add(dirLight);

function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth/(window.innerHeight-50);
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight-50);
});

// Caricamento modello
document.getElementById("fileInput").addEventListener("change", e=>{
  const file = e.target.files[0];
  if (!file) return;
  const ext = file.name.split(".").pop().toLowerCase();
  const reader = new FileReader();
  reader.onload = ev=>{
    if (currentObject) { scene.remove(currentObject); currentObject=null; }
    if (ext==="glb" || ext==="gltf"){
      new THREE.GLTFLoader().parse(ev.target.result, "", gltf=>{
        currentObject=gltf.scene; scene.add(currentObject);
      });
    } else if (ext==="obj"){
      const text=new TextDecoder().decode(ev.target.result);
      currentObject=new THREE.OBJLoader().parse(text);
      scene.add(currentObject);
    } else if (ext==="dae"){
      const parser=new DOMParser().parseFromString(new TextDecoder().decode(ev.target.result),"application/xml");
      currentObject=new THREE.ColladaLoader().parse(parser).scene;
      scene.add(currentObject);
    }
  };
  if (ext==="glb") reader.readAsArrayBuffer(file);
  else reader.readAsText(file);
});
</script>
</body>
</html>
